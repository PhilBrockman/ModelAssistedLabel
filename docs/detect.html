---

title: Detecting Objects


keywords: fastai
sidebar: home_sidebar

summary: "wrapping `detect.py`"
description: "wrapping `detect.py`"
nb_path: "03_detect.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: 03_detect.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">run</span> &quot;_Synch.ipynb&quot;
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Drive already mounted at /content/drive; to attempt to forcibly remount, call drive.mount(&#34;/content/drive&#34;, force_remount=True).
/content/drive/MyDrive/Coding/ModelAssistedLabel
install nbdev: yes
git commit -m: updating the detector to stop writing to disk
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="Detector" class="doc_header"><code>class</code> <code>Detector</code><a href="ModelAssistedLabel/core.py#L554" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>Detector</code>(<strong><code>weight_path</code></strong>, <strong><code>conf_threshold</code></strong>=<em><code>0.4</code></em>, <strong><code>iou_threshold</code></strong>=<em><code>0.45</code></em>, <strong><code>imgsz</code></strong>=<em><code>416</code></em>, <strong><code>save_dir</code></strong>=<em><code>'save_dir'</code></em>, <strong><code>save_labeled_img</code></strong>=<em><code>True</code></em>, <strong><code>log_bboxes_as_txt</code></strong>=<em><code>True</code></em>)</p>
</blockquote>
<p>A wrapper for training loading saved YOLOv5 weights</p>
<p>requirements:
  GPU enabled</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">d</span><span class="o">=</span><span class="n">Detector</span><span class="p">(</span><span class="s2">&quot;pre-trained YOLOv5 weights/21-2-25 1k-digits YOLOv5-weights.pt&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Fusing layers... 
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">time</span>
path = &quot;Image Repo/labeled/Final Roboflow Export (841)/images/&quot;
dir = os.listdir(path)
r = d.process_image(path+&quot;digittake-11-jpg_jpg.rf.35b398c6cd3bbcf368b2ac33fecf4ba1.jpg&quot;, 
                save_unscuffed=False)
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>image 1/1 /content/drive/MyDrive/Coding/ModelAssistedLabel/Image Repo/labeled/Final Roboflow Export (841)/images/digittake-11-jpg_jpg.rf.35b398c6cd3bbcf368b2ac33fecf4ba1.jpg: {&#39;predictions&#39;: [&#39;6 0.375 0.436458 0.025 0.0854167 0.889039&#39;, &#39;2 0.3375 0.436458 0.028125 0.0895833 0.927515&#39;, &#39;3 0.407813 0.439583 0.028125 0.0833333 0.937184&#39;, &#39;4 0.441406 0.441667 0.0296875 0.0875 0.94276&#39;], &#39;labeled&#39;: &#39;save_dir/labeled-digittake-11-jpg_jpg.rf.35b398c6cd3bbcf368b2ac33fecf4ba1.jpg&#39;}
CPU times: user 46.5 ms, sys: 392 Âµs, total: 46.9 ms
Wall time: 78.8 ms
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">r</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;labeled&#39;: &#39;save_dir/labeled-digittake-11-jpg_jpg.rf.35b398c6cd3bbcf368b2ac33fecf4ba1.jpg&#39;,
 &#39;predictions&#39;: [&#39;6 0.375 0.436458 0.025 0.0854167 0.889039&#39;,
  &#39;2 0.3375 0.436458 0.028125 0.0895833 0.927515&#39;,
  &#39;3 0.407813 0.439583 0.028125 0.0833333 0.937184&#39;,
  &#39;4 0.441406 0.441667 0.0296875 0.0875 0.94276&#39;]}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="data-set:-preparing-bounding-boxes-for-post-processing">data set: preparing bounding boxes for post-processing<a class="anchor-link" href="#data-set:-preparing-bounding-boxes-for-post-processing"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="Frame" class="doc_header"><code>class</code> <code>Frame</code><a href="ModelAssistedLabel/core.py#L691" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>Frame</code>(<strong><code>jpg_file</code></strong>, <strong><code>predictions</code></strong>=<em><code>[]</code></em>)</p>
</blockquote>
<p>Container for holding an image along with any predictions</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="Prediction" class="doc_header"><code>class</code> <code>Prediction</code><a href="ModelAssistedLabel/core.py#L706" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>Prediction</code>(<strong><code>txt_file</code></strong>=<em><code>None</code></em>, <strong><code>parent</code></strong>=<em><code>None</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="DataSet" class="doc_header"><code>class</code> <code>DataSet</code><a href="ModelAssistedLabel/core.py#L735" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>DataSet</code>(<strong><code>image_list</code></strong>)</p>
</blockquote>
<p>holds together a series of Frame objects with the eventual goal of exporting
the data contained therein to a JSON-friendly format</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="__cv2_2_str__" class="doc_header"><code>__cv2_2_str__</code><a href="ModelAssistedLabel/core.py#L776" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>__cv2_2_str__</code>(<strong><code>image</code></strong>)</p>
</blockquote>
<p>Converts a cv2 imread to base 64</p>
<p>Args:
  image: resultant value of cv2 imread</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="New-Section">New Section<a class="anchor-link" href="#New-Section"> </a></h1>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="New-Section">New Section<a class="anchor-link" href="#New-Section"> </a></h1>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="resolving-conflicts">resolving conflicts<a class="anchor-link" href="#resolving-conflicts"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="bb_intersection_over_union" class="doc_header"><code>bb_intersection_over_union</code><a href="ModelAssistedLabel/core.py#L789" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>bb_intersection_over_union</code>(<strong><code>boxA</code></strong>, <strong><code>boxB</code></strong>)</p>
</blockquote>
<p>Source: <a href="https://www.pyimagesearch.com/2016/11/07/intersection-over-union-iou-for-object-detection/">https://www.pyimagesearch.com/2016/11/07/intersection-over-union-iou-for-object-detection/</a></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="sorted_api" class="doc_header"><code>sorted_api</code><a href="ModelAssistedLabel/core.py#L814" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>sorted_api</code>(<strong><code>predictions</code></strong>)</p>
</blockquote>
<p>sorts a list of prediction in ascending x order</p>
<p>Args:
  an array of dictionaries containing bbox predictions</p>
<p>Returns:
  the bounding boxes read off from left to right</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="digit_arr_to_string" class="doc_header"><code>digit_arr_to_string</code><a href="ModelAssistedLabel/core.py#L824" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>digit_arr_to_string</code>(<strong><code>predictions</code></strong>)</p>
</blockquote>
<p>"Human-friendly interpretation of predictions</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="corners" class="doc_header"><code>corners</code><a href="ModelAssistedLabel/core.py#L829" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>corners</code>(<strong><code>r</code></strong>)</p>
</blockquote>
<p>Defines the relevante coordinate information</p>
<p>Args:
  r: converts a DataFrame row to a tuple</p>
<p>Returns:
  Caretensian coordinate information (anchor in the lower left)</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="calculate_iou" class="doc_header"><code>calculate_iou</code><a href="ModelAssistedLabel/core.py#L841" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>calculate_iou</code>(<strong><code>frame</code></strong>, <strong><code>threshold</code></strong>=<em><code>0.4</code></em>)</p>
</blockquote>
<p>Determines the pair of bounding boxes that has the highest IoU over the :threshold:</p>
<p>Args:
  frame: the output of either a YOLOv5 model call or an API call
  threshold: maximum percentage of overlap allowed between the bounding boxes</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>{% include note.html content='the following functions work together to form the core of parsing bounding' %}box information.
{% include warning.html content='I assume that screens have no more than 4 objects in them.' %}
If extra bounding boxesare detected, I find the pair of boxes that has the highest IoU (Intersection 
over Union). Of that pair, I identify the box that has the a lower associated
confidence and remove it.</p>
<p>If there is still an excess of bounding boxes but no boxes that are overlapping
in excess of the :threshold:, then bounding boxes with the most deviated y are 
removed</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">interpret_predictions</span><span class="p">(</span><span class="n">predictions_arr</span><span class="p">):</span>
  <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">predictions_arr</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">predictions_arr</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">remove_worst</span><span class="p">(</span><span class="n">predictions_arr</span><span class="p">)):</span>
    <span class="n">predictions_arr</span> <span class="o">=</span> <span class="n">remove_worst</span><span class="p">(</span><span class="n">predictions_arr</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">predictions_arr</span>

<span class="k">def</span> <span class="nf">remove_worst_offender</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">threshold</span><span class="p">):</span>
  <span class="n">overlappers</span> <span class="o">=</span> <span class="n">calculate_iou</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
  
  <span class="k">if</span> <span class="n">overlappers</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">included</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">res</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;index&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">overlappers</span><span class="p">[</span><span class="s2">&quot;least confident&quot;</span><span class="p">][</span><span class="s2">&quot;index&quot;</span><span class="p">]]</span>
    <span class="k">return</span> <span class="n">included</span>
  <span class="k">else</span><span class="p">:</span> <span class="c1">#look for y outlier</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
    <span class="c1"># print(df.sort_values(by=&quot;confidence&quot;,ascending=False))</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;zscore&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">df</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span><span class="o">/</span><span class="n">df</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">std</span><span class="p">()</span> <span class="c1">#FIXME</span>
    <span class="k">return</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;zscore&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">1.5</span><span class="p">]</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="s1">&#39;records&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">remove_worst</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=.</span><span class="mi">4</span><span class="p">):</span>
  <span class="k">return</span> <span class="n">remove_worst_offender</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">threshold</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="post-processing">post-processing<a class="anchor-link" href="#post-processing"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="yoloBox_to_standard" class="doc_header"><code>yoloBox_to_standard</code><a href="ModelAssistedLabel/core.py#L873" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>yoloBox_to_standard</code>(<strong><code>result</code></strong>)</p>
</blockquote>
<p>The standard YOLOv5 coordinate format is normed to 1. Need to extract the
original's image width and height to convert to a standard cartesian plane.</p>
<p>Args:
  result: a dictionary that includes both</p>

<pre><code>  * a key called "filename" that points to the original image
  * a key called "predictions" created when the image is parsed with the
    YOLOv5 model

</code></pre>
<p>Returns:
  Convert the predictions converted to a full-scale Cartesian coordinate system.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="raw_parse_from_json" class="doc_header"><code>raw_parse_from_json</code><a href="ModelAssistedLabel/core.py#L911" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>raw_parse_from_json</code>(<strong><code>json_elements</code></strong>, <strong><code>loaded_detector</code></strong>)</p>
</blockquote>
<p>Helper to interpret raw base 64 images. Creates a new JPG file from the base64
data and feeds the image to the Detector</p>
<p>Args:
  json_elements: array of dictionaries from file. Assert existence of a "base64"
    key where the images are stored
  loaded_detector: a valid Detector</p>
<p>returns:
  the result of processessing all of the base64 images</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="parse_from_json" class="doc_header"><code>parse_from_json</code><a href="ModelAssistedLabel/core.py#L936" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>parse_from_json</code>(<strong><code>json_elements</code></strong>, <strong><code>loaded_detector</code></strong>)</p>
</blockquote>
<p>Gets a JSON file containing the base64 images of data to label pushed through
a Detector. Post-processing automatically de-norms the YOLOv5 bounding boxes
based on the original image's height and width</p>
<p>Args:
  json_elements: array of dictionaries from file. Assert existence of a "base64"
    key where the images are stored
  loaded_detector: a valid Detector</p>
<p>returns:
  the bounding boxes associated with each image</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Configure-Environment">Configure Environment<a class="anchor-link" href="#Configure-Environment"> </a></h1><p>My weights and images are stored in my Google Drive. You may need to configure your settings differently according to your specific setup</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">the weights and images are stored my Google Drive</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">google.colab</span> <span class="kn">import</span> <span class="n">drive</span>
<span class="n">drive</span><span class="o">.</span><span class="n">mount</span><span class="p">(</span><span class="s1">&#39;/content/drive&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Mounted at /content/drive
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">cd</span> &quot;/content/drive/MyDrive/Coding/ModelAssistedLabel&quot;
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>/content/drive/MyDrive/Coding/ModelAssistedLabel
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">run</span> &quot;_Synch.ipynb&quot;
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>/content/drive/MyDrive/Coding/ModelAssistedLabel
install nbdev: ye
git commit -m: hunting the checkmark1
Converted 00_config.ipynb.
Converted 01_split.ipynb.
Converted 02_train.ipynb.
Converted index.ipynb.
converting: /content/drive/My Drive/Coding/ModelAssistedLabel/index.ipynb
converting /content/drive/My Drive/Coding/ModelAssistedLabel/index.ipynb to README.md
Executing: git config --local include.path ../.gitconfig
Success: hooks are installed and repo&#39;s .gitconfig is now trusted

[master 27e8c0d] hunting the checkmark1
 1 file changed, 13 insertions(+), 13 deletions(-)
Counting objects: 3, done.
Delta compression using up to 2 threads.
Compressing objects: 100% (3/3), done.
Writing objects: 100% (3/3), 511 bytes | 170.00 KiB/s, done.
Total 3 (delta 2), reused 0 (delta 0)
remote: Resolving deltas: 100% (2/2), completed with 2 local objects.
To https://github.com/PhilBrockman/ModelAssistedLabel.git
   5fe1621..27e8c0d  master -&gt; master
Branch &#39;master&#39; set up to track remote branch &#39;master&#39; from &#39;origin&#39;.
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#@title Point me to some local paths</span>

<span class="c1"># trained with YOLOv5 train.py</span>
<span class="c1">#@markdown file location where the model&#39;s weights are being stored</span>
<span class="n">weights_filename</span> <span class="o">=</span> <span class="s1">&#39;21-2-25 1k-digits YOLOv5-weights.pt&#39;</span> <span class="c1">#@param {type: &quot;string&quot;}</span>

<span class="c1"># a JSON array of dictionaries. Assumes images are stored in the base64 format</span>
<span class="c1"># in the dictionary&#39;s key called &quot;base64&quot;</span>
<span class="c1">#@markdown file location to the JSON file that has image to be evaluated. </span>
<span class="c1">#@markdown [See more](https://gist.github.com/PhilBrockman/776a86a16d93038294b0fd8c1be63582?short_path=a22f722)</span>
<span class="c1">#@markdown about how I am generating JSON from images</span>
<span class="n">base64_images</span> <span class="o">=</span> <span class="s2">&quot;./additional lcd images/21-3-3 control-camera-light.json&quot;</span> <span class="c1">#@param {type: &quot;string&quot;}</span>


<span class="c1">#@markdown `curl` location &amp; access token is defined by Roboflow API </span>
<span class="n">RUN_ROBOFLOW_API</span> <span class="o">=</span> <span class="s2">&quot;False&quot;</span> <span class="c1">#@param [&quot;False&quot;, &quot;True&quot;]</span>
<span class="n">URL_WITH_ACCESS_TOKEN</span> <span class="o">=</span> <span class="s2">&quot;https://infer.roboflow.com/&lt;DB}&gt;access_token=&lt;API_TOKEN&gt;&quot;</span> <span class="c1">#@param {type: &quot;string&quot;}</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Interact-with-Models">Interact with Models<a class="anchor-link" href="#Interact-with-Models"> </a></h1><p>Data has been loaded. Weights are findable.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">resource_folder</span> <span class="o">=</span> <span class="s2">&quot;/content/drive/MyDrive/Coding/Roboflow/try it out&quot;</span>
<span class="n">weights_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">resource_folder</span><span class="p">,</span> <span class="n">weights_filename</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">digitDetector</span> <span class="o">=</span> <span class="n">Detector</span><span class="p">(</span><span class="n">weights_path</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Fusing layers... 
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Process the json in the <strong>base64_images</strong> path</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">resource_folder</span><span class="p">,</span> <span class="n">base64_images</span><span class="p">))</span> <span class="k">as</span> <span class="n">json_file</span><span class="p">:</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">json_file</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">random</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">postprocess</span><span class="o">=</span><span class="n">parse_from_json</span><span class="p">(</span> <span class="n">data</span><span class="p">,</span> <span class="n">loaded_detector</span><span class="o">=</span><span class="n">digitDetector</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>image 1/1 /content/yolov5/(1) image.jpg: image 1/1 /content/yolov5/(2) image.jpg: image 1/1 /content/yolov5/(3) image.jpg: image 1/1 /content/yolov5/(4) image.jpg: image 1/1 /content/yolov5/(5) image.jpg: image 1/1 /content/yolov5/(6) image.jpg: image 1/1 /content/yolov5/(7) image.jpg: image 1/1 /content/yolov5/(8) image.jpg: image 1/1 /content/yolov5/(9) image.jpg: image 1/1 /content/yolov5/(10) image.jpg: image 1/1 /content/yolov5/(11) image.jpg: image 1/1 /content/yolov5/(12) image.jpg: image 1/1 /content/yolov5/(13) image.jpg: image 1/1 /content/yolov5/(14) image.jpg: image 1/1 /content/yolov5/(15) image.jpg: image 1/1 /content/yolov5/(16) image.jpg: image 1/1 /content/yolov5/(17) image.jpg: image 1/1 /content/yolov5/(18) image.jpg: image 1/1 /content/yolov5/(19) image.jpg: image 1/1 /content/yolov5/(20) image.jpg: image 1/1 /content/yolov5/(21) image.jpg: image 1/1 /content/yolov5/(22) image.jpg: image 1/1 /content/yolov5/(23) image.jpg: image 1/1 /content/yolov5/(24) image.jpg: image 1/1 /content/yolov5/(25) image.jpg: image 1/1 /content/yolov5/(26) image.jpg: image 1/1 /content/yolov5/(27) image.jpg: image 1/1 /content/yolov5/(28) image.jpg: image 1/1 /content/yolov5/(29) image.jpg: image 1/1 /content/yolov5/(30) image.jpg: image 1/1 /content/yolov5/(31) image.jpg: image 1/1 /content/yolov5/(32) image.jpg: image 1/1 /content/yolov5/(33) image.jpg: image 1/1 /content/yolov5/(34) image.jpg: image 1/1 /content/yolov5/(35) image.jpg: image 1/1 /content/yolov5/(36) image.jpg: image 1/1 /content/yolov5/(37) image.jpg: image 1/1 /content/yolov5/(38) image.jpg: image 1/1 /content/yolov5/(39) image.jpg: image 1/1 /content/yolov5/(40) image.jpg: image 1/1 /content/yolov5/(41) image.jpg: image 1/1 /content/yolov5/(42) image.jpg: image 1/1 /content/yolov5/(43) image.jpg: image 1/1 /content/yolov5/(44) image.jpg: image 1/1 /content/yolov5/(45) image.jpg: image 1/1 /content/yolov5/(46) image.jpg: image 1/1 /content/yolov5/(47) image.jpg: image 1/1 /content/yolov5/(48) image.jpg: image 1/1 /content/yolov5/(49) image.jpg: image 1/1 /content/yolov5/(50) image.jpg: image 1/1 /content/yolov5/(51) image.jpg: image 1/1 /content/yolov5/(52) image.jpg: image 1/1 /content/yolov5/(53) image.jpg: image 1/1 /content/yolov5/(54) image.jpg: image 1/1 /content/yolov5/(55) image.jpg: image 1/1 /content/yolov5/(56) image.jpg: image 1/1 /content/yolov5/(57) image.jpg: image 1/1 /content/yolov5/(58) image.jpg: image 1/1 /content/yolov5/(59) image.jpg: image 1/1 /content/yolov5/(60) image.jpg: image 1/1 /content/yolov5/(61) image.jpg: image 1/1 /content/yolov5/(62) image.jpg: image 1/1 /content/yolov5/(63) image.jpg: image 1/1 /content/yolov5/(64) image.jpg: image 1/1 /content/yolov5/(65) image.jpg: image 1/1 /content/yolov5/(66) image.jpg: image 1/1 /content/yolov5/(67) image.jpg: image 1/1 /content/yolov5/(68) image.jpg: image 1/1 /content/yolov5/(69) image.jpg: image 1/1 /content/yolov5/(70) image.jpg: image 1/1 /content/yolov5/(71) image.jpg: image 1/1 /content/yolov5/(72) image.jpg: image 1/1 /content/yolov5/(73) image.jpg: image 1/1 /content/yolov5/(74) image.jpg: image 1/1 /content/yolov5/(75) image.jpg: image 1/1 /content/yolov5/(76) image.jpg: image 1/1 /content/yolov5/(77) image.jpg: image 1/1 /content/yolov5/(78) image.jpg: image 1/1 /content/yolov5/(79) image.jpg: image 1/1 /content/yolov5/(80) image.jpg: image 1/1 /content/yolov5/(81) image.jpg: image 1/1 /content/yolov5/(82) image.jpg: image 1/1 /content/yolov5/(83) image.jpg: image 1/1 /content/yolov5/(84) image.jpg: image 1/1 /content/yolov5/(85) image.jpg: image 1/1 /content/yolov5/(86) image.jpg: image 1/1 /content/yolov5/(87) image.jpg: image 1/1 /content/yolov5/(88) image.jpg: image 1/1 /content/yolov5/(89) image.jpg: image 1/1 /content/yolov5/(90) image.jpg: image 1/1 /content/yolov5/(91) image.jpg: image 1/1 /content/yolov5/(92) image.jpg: image 1/1 /content/yolov5/(93) image.jpg: image 1/1 /content/yolov5/(94) image.jpg: image 1/1 /content/yolov5/(95) image.jpg: image 1/1 /content/yolov5/(96) image.jpg: image 1/1 /content/yolov5/(97) image.jpg: image 1/1 /content/yolov5/(98) image.jpg: image 1/1 /content/yolov5/(99) image.jpg: image 1/1 /content/yolov5/(100) image.jpg: image 1/1 /content/yolov5/(101) image.jpg: image 1/1 /content/yolov5/(102) image.jpg: image 1/1 /content/yolov5/(103) image.jpg: image 1/1 /content/yolov5/(104) image.jpg: image 1/1 /content/yolov5/(105) image.jpg: image 1/1 /content/yolov5/(106) image.jpg: image 1/1 /content/yolov5/(107) image.jpg: image 1/1 /content/yolov5/(108) image.jpg: image 1/1 /content/yolov5/(109) image.jpg: image 1/1 /content/yolov5/(110) image.jpg: image 1/1 /content/yolov5/(111) image.jpg: image 1/1 /content/yolov5/(112) image.jpg: image 1/1 /content/yolov5/(113) image.jpg: image 1/1 /content/yolov5/(114) image.jpg: image 1/1 /content/yolov5/(115) image.jpg: image 1/1 /content/yolov5/(116) image.jpg: image 1/1 /content/yolov5/(117) image.jpg: image 1/1 /content/yolov5/(118) image.jpg: image 1/1 /content/yolov5/(119) image.jpg: image 1/1 /content/yolov5/(120) image.jpg: image 1/1 /content/yolov5/(121) image.jpg: image 1/1 /content/yolov5/(122) image.jpg: image 1/1 /content/yolov5/(123) image.jpg: image 1/1 /content/yolov5/(124) image.jpg: image 1/1 /content/yolov5/(125) image.jpg: image 1/1 /content/yolov5/(126) image.jpg: image 1/1 /content/yolov5/(127) image.jpg: image 1/1 /content/yolov5/(128) image.jpg: image 1/1 /content/yolov5/(129) image.jpg: image 1/1 /content/yolov5/(130) image.jpg: image 1/1 /content/yolov5/(131) image.jpg: image 1/1 /content/yolov5/(132) image.jpg: image 1/1 /content/yolov5/(133) image.jpg: image 1/1 /content/yolov5/(134) image.jpg: image 1/1 /content/yolov5/(135) image.jpg: image 1/1 /content/yolov5/(136) image.jpg: image 1/1 /content/yolov5/(137) image.jpg: image 1/1 /content/yolov5/(138) image.jpg: image 1/1 /content/yolov5/(139) image.jpg: image 1/1 /content/yolov5/(140) image.jpg: image 1/1 /content/yolov5/(141) image.jpg: image 1/1 /content/yolov5/(142) image.jpg: image 1/1 /content/yolov5/(143) image.jpg: image 1/1 /content/yolov5/(144) image.jpg: image 1/1 /content/yolov5/(145) image.jpg: image 1/1 /content/yolov5/(146) image.jpg: image 1/1 /content/yolov5/(147) image.jpg: image 1/1 /content/yolov5/(148) image.jpg: image 1/1 /content/yolov5/(149) image.jpg: image 1/1 /content/yolov5/(150) image.jpg: image 1/1 /content/yolov5/(151) image.jpg: image 1/1 /content/yolov5/(152) image.jpg: image 1/1 /content/yolov5/(153) image.jpg: image 1/1 /content/yolov5/(154) image.jpg: image 1/1 /content/yolov5/(155) image.jpg: image 1/1 /content/yolov5/(156) image.jpg: image 1/1 /content/yolov5/(157) image.jpg: image 1/1 /content/yolov5/(158) image.jpg: image 1/1 /content/yolov5/(159) image.jpg: image 1/1 /content/yolov5/(160) image.jpg: image 1/1 /content/yolov5/(161) image.jpg: image 1/1 /content/yolov5/(162) image.jpg: image 1/1 /content/yolov5/(163) image.jpg: image 1/1 /content/yolov5/(164) image.jpg: image 1/1 /content/yolov5/(165) image.jpg: image 1/1 /content/yolov5/(166) image.jpg: image 1/1 /content/yolov5/(167) image.jpg: image 1/1 /content/yolov5/(168) image.jpg: image 1/1 /content/yolov5/(169) image.jpg: image 1/1 /content/yolov5/(170) image.jpg: image 1/1 /content/yolov5/(171) image.jpg: image 1/1 /content/yolov5/(172) image.jpg: image 1/1 /content/yolov5/(173) image.jpg: image 1/1 /content/yolov5/(174) image.jpg: image 1/1 /content/yolov5/(175) image.jpg: image 1/1 /content/yolov5/(176) image.jpg: image 1/1 /content/yolov5/(177) image.jpg: image 1/1 /content/yolov5/(178) image.jpg: image 1/1 /content/yolov5/(179) image.jpg: image 1/1 /content/yolov5/(180) image.jpg: image 1/1 /content/yolov5/(181) image.jpg: image 1/1 /content/yolov5/(182) image.jpg: image 1/1 /content/yolov5/(183) image.jpg: image 1/1 /content/yolov5/(184) image.jpg: image 1/1 /content/yolov5/(185) image.jpg: image 1/1 /content/yolov5/(186) image.jpg: image 1/1 /content/yolov5/(187) image.jpg: image 1/1 /content/yolov5/(188) image.jpg: image 1/1 /content/yolov5/(189) image.jpg: image 1/1 /content/yolov5/(190) image.jpg: image 1/1 /content/yolov5/(191) image.jpg: image 1/1 /content/yolov5/(192) image.jpg: image 1/1 /content/yolov5/(193) image.jpg: image 1/1 /content/yolov5/(194) image.jpg: image 1/1 /content/yolov5/(195) image.jpg: image 1/1 /content/yolov5/(196) image.jpg: image 1/1 /content/yolov5/(197) image.jpg: image 1/1 /content/yolov5/(198) image.jpg: image 1/1 /content/yolov5/(199) image.jpg: image 1/1 /content/yolov5/(200) image.jpg: </pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>If <strong>RUN_ROBOFLOW_API</strong> is <code>True</code>, then the images from the processed JSON will be <code>curl</code>ed to <strong>URL_WITH_ACCESS_TOKEN</strong></p>
<p>If <strong>RUN_ROBOFLOW_API</strong> is <code>False</code>, then the predictions will uniformly be <code>[]</code></p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">unfurl_curl_predictions</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Queries the Roboflow API at :URL_WITH_ACCESS_TOKEN: with a chosen image. </span>

<span class="sd">  Args:</span>
<span class="sd">    filename: path to the image to parse through the API</span>

<span class="sd">  Returns:</span>
<span class="sd">    a list of predictions if a valide URL. Otherwise returns an empty list.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">if</span> <span class="n">RUN_ROBOFLOW_API</span> <span class="o">==</span> <span class="s2">&quot;True&quot;</span><span class="p">:</span>
    <span class="n">r</span> <span class="o">=</span> <span class="o">!</span>base64 <span class="s2">&quot;{filename}&quot;</span> <span class="p">|</span> curl -d @- <span class="s2">&quot;{URL_WITH_ACCESS_TOKEN}&quot;</span>
    <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">])[</span><span class="s2">&quot;predictions&quot;</span><span class="p">]</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="k">return</span> <span class="p">[]</span>

<span class="c1"># for each image, collect the predictions made by API</span>
<span class="n">api_res</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">postprocess</span><span class="p">)):</span>
  <span class="n">api_res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">unfurl_curl_predictions</span><span class="p">(</span><span class="n">postprocess</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;filename&quot;</span><span class="p">]))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Interpret the results</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

<span class="c1">#determine the YOLOv5 predictions</span>
<span class="n">df</span><span class="p">[</span><span class="s2">&quot;yolo&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">digit_arr_to_string</span><span class="p">(</span><span class="n">interpret_predictions</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s2">&quot;predictions&quot;</span><span class="p">]))</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">postprocess</span><span class="p">]</span>

<span class="c1">#capture the original YOLOv5 predictions</span>
<span class="n">df</span><span class="p">[</span><span class="s2">&quot;yolo original&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">digit_arr_to_string</span><span class="p">((</span><span class="n">x</span><span class="p">[</span><span class="s2">&quot;predictions&quot;</span><span class="p">]))</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">postprocess</span><span class="p">]</span>


<span class="k">if</span> <span class="n">RUN_ROBOFLOW_API</span> <span class="o">==</span> <span class="s2">&quot;True&quot;</span><span class="p">:</span>
  <span class="c1">#determine the API&#39;s predictions</span>
  <span class="n">df</span><span class="p">[</span><span class="s2">&quot;api&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">digit_arr_to_string</span><span class="p">(</span><span class="n">interpret_predictions</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">api_res</span><span class="p">]</span>

  <span class="n">named_subsets</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;disagree&quot;</span><span class="p">:</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;yolo&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;api&quot;</span><span class="p">]],</span> <span class="c1">#do the models come to the same conclusion?</span>
    <span class="s2">&quot;agree&quot;</span><span class="p">:</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;yolo&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;api&quot;</span><span class="p">]]</span> <span class="c1">#is there a difference?</span>
  <span class="p">}</span> 

  <span class="c1"># get a rough sense for the numbers involved</span>
  <span class="nb">print</span><span class="p">([</span><span class="n">x</span> <span class="o">+</span> <span class="s2">&quot;: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">named_subsets</span><span class="p">[</span><span class="n">x</span><span class="p">]))</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">named_subsets</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[&#39;disagree: 180&#39;, &#39;agree: 20&#39;]
</pre>
</div>
</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>yolo</th>
      <th>yolo original</th>
      <th>api</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>029</td>
      <td>029</td>
      <td>4029</td>
    </tr>
    <tr>
      <th>1</th>
      <td>029</td>
      <td>029</td>
      <td>9029</td>
    </tr>
    <tr>
      <th>2</th>
      <td>029</td>
      <td>029</td>
      <td>4029</td>
    </tr>
    <tr>
      <th>3</th>
      <td>029</td>
      <td>029</td>
      <td>9029</td>
    </tr>
    <tr>
      <th>4</th>
      <td>3031</td>
      <td>3031</td>
      <td>9031</td>
    </tr>
    <tr>
      <th>5</th>
      <td>032</td>
      <td>0232</td>
      <td>9032</td>
    </tr>
    <tr>
      <th>6</th>
      <td>033</td>
      <td>033</td>
      <td>9033</td>
    </tr>
    <tr>
      <th>7</th>
      <td>4035</td>
      <td>4035</td>
      <td>9035</td>
    </tr>
    <tr>
      <th>8</th>
      <td>036</td>
      <td>036</td>
      <td>9036</td>
    </tr>
    <tr>
      <th>9</th>
      <td>4037</td>
      <td>4037</td>
      <td>4037</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># along with the original</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">row</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
  <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;index&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
  <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;yolo:&quot;</span><span class="p">,</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;yolo&quot;</span><span class="p">],</span> <span class="s2">&quot;&lt;&lt;&lt;&quot;</span><span class="p">,</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;yolo original&quot;</span><span class="p">])</span>
  <span class="k">if</span> <span class="n">RUN_ROBOFLOW_API</span> <span class="o">==</span> <span class="s2">&quot;True&quot;</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;api: &quot;</span><span class="p">,</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;api&quot;</span><span class="p">])</span>
  <span class="n">display</span><span class="p">(</span><span class="n">PIL</span><span class="o">.</span><span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">postprocess</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)][</span><span class="s2">&quot;filename&quot;</span><span class="p">]))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>If the checkbox is unmarked, no file will be created, no file will be downloaded.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">outfilename</span> <span class="o">=</span> <span class="s2">&quot;YY-MM-DD save results.json&quot;</span> <span class="c1">#@param {type:&quot;string&quot;}</span>
<span class="n">save</span> <span class="o">=</span> <span class="kc">False</span> <span class="c1">#@param {type:&quot;boolean&quot;}</span>

<span class="k">if</span> <span class="n">save</span><span class="p">:</span>
  <span class="n">outJSON</span> <span class="o">=</span> <span class="p">{}</span>
  <span class="n">outJSON</span><span class="p">[</span><span class="s2">&quot;processed&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">postprocess</span>
  <span class="n">outJSON</span><span class="p">[</span><span class="s2">&quot;df&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
  <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">outfilename</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outfile</span><span class="p">:</span>
    <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">outJSON</span><span class="p">,</span> <span class="n">outfile</span><span class="p">)</span>

  <span class="c1"># download the JSON for safe-keeping</span>
  <span class="kn">from</span> <span class="nn">google.colab</span> <span class="kn">import</span> <span class="n">files</span>
  <span class="n">files</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="n">outfilename</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

</div>
 

